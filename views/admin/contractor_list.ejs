<%-include('navbar.ejs')%>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        .modal-content {
            border-radius: 8px;
        }

        .form-label {
            font-weight: bold;
            font-size: 0.85rem;
            text-transform: uppercase;
        }

        .btn-purple {
            background-color: #7a3eb1;
            color: #fff;
        }

        .btn-purple:hover {
            background-color: #622f91;
            color: #fff;
        }

        .btn-warning {
            background-color: #f6c344;
            border: none;
            color: #000;
        }

        .btn-warning:hover {
            background-color: #e0ad2f;
        }

        .btn-grey {
            background-color: #6c757d;
            color: #fff;
            font-size: 13px;
            text-transform: uppercase;
        }

        .btn-grey:hover {
            background-color: #5a6268;
            color: #fff;
        }
    </style>
    <!-- Main Contractor Modal -->
    <div class="modal fade" id="contractorModal" tabindex="-1" aria-labelledby="contractorModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content shadow">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold" id="contractorModalLabel">
                        ADD NEW CONTRACTOR
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body">
                    <form id="contractorForm" class="needs-validation" novalidate>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">CONTRACTOR NAME*</label>
                                <input type="text" class="form-control" placeholder="ENTER CONTRACTOR NAME" required />
                                <div class="invalid-feedback">
                                    Contractor Name is required.
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">CONTRACTOR ADDRESS*</label>
                                <input type="text" class="form-control" placeholder="ENTER CONTRACTOR ADDRESS"
                                    required />
                                <div class="invalid-feedback">
                                    Contractor Address is required.
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">CONTRACTOR OTHER DETAILS</label>
                                <input type="text" class="form-control" placeholder="ENTER CONTRACTOR OTHER DETAILS" />
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">CONTRACTOR MOBILE*</label>
                                <input type="tel" class="form-control" placeholder="ENTER CONTRACTOR MOBILE NUMBER"
                                    required pattern="[0-9]{10}" />
                                <div class="invalid-feedback">
                                    Enter a valid 10-digit mobile number.
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">CONTRACTOR ADHAR CARD NO</label>
                                <input type="text" class="form-control" placeholder="ADHAR CARD NUMBER"
                                    pattern="[0-9]{12}" />
                                <div class="invalid-feedback">Aadhar must be 12 digits.</div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">CONTRACTOR PAN CARD NO</label>
                                <input type="text" class="form-control" placeholder="PAN CARD NUMBER"
                                    pattern="[A-Z]{5}[0-9]{4}[A-Z]{1}" />
                                <div class="invalid-feedback">
                                    Enter a valid PAN (ABCDE1234F).
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">CONTRACTOR IMAGE</label>
                                <input type="file" class="form-control" />
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">CONTRACTOR TYPE</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="mainContractorType"
                                        placeholder="ENTER CONTRACTOR TYPE" />
                                    <button class="btn btn-primary" type="button" data-bs-toggle="modal"
                                        data-bs-target="#contractorTypeModal">
                                        +
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="modal-footer mt-3">
                            <button type="submit" class="btn btn-purple">
                                ADD CONTRACTOR
                            </button>
                            <button type="button" class="btn btn-warning" data-bs-dismiss="modal">
                                Close
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Contractor Type Modal -->
    <div class="modal fade" id="contractorTypeModal" tabindex="-1" aria-labelledby="contractorTypeLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content p-2">
                <div class="modal-header">
                    <h6 class="modal-title fw-bold" id="contractorTypeLabel">
                        ADD NEW CONTRACTOR TYPE
                    </h6>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="contractorTypeForm">
                        <div class="mb-3">
                            <label for="contractorType" class="form-label">CONTRACTOR TYPE*</label>
                            <input type="text" class="form-control" id="contractorType"
                                placeholder="ENTER CONTRACTOR TYPE" required />
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-purple" id="saveContractorType">
                        ADD CONTRACTOR TYPE
                    </button>
                    <button type="button" class="btn btn-grey" data-bs-dismiss="modal">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        (function () {
            "use strict";
            const form = document.getElementById("contractorForm");
            form.addEventListener(
                "submit",
                function (event) {
                    if (!form.checkValidity()) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    form.classList.add("was-validated");
                },
                false
            );

            // Auto open main modal when page loads
            const myModal = new bootstrap.Modal(
                document.getElementById("contractorModal")
            );
            window.addEventListener("load", () => {
                myModal.show();
            });
        })();

        // Save contractor type
        document
            .getElementById("saveContractorType")
            .addEventListener("click", function () {
                const typeInput = document.getElementById("contractorType");
                const mainTypeInput = document.getElementById("mainContractorType");

                if (typeInput.value.trim() !== "") {
                    mainTypeInput.value = typeInput.value.trim();
                    typeInput.value = "";
                    bootstrap.Modal.getInstance(
                        document.getElementById("contractorTypeModal")
                    ).hide();
                } else {
                    alert("Please enter a Contractor Type.");
                }
            });

        // Reopen parent modal when child closes
        document
            .getElementById("contractorTypeModal")
            .addEventListener("hidden.bs.modal", function () {
                const parentModal = document.getElementById("contractorModal");
                const parentInstance =
                    bootstrap.Modal.getInstance(parentModal) ||
                    new bootstrap.Modal(parentModal);
                parentInstance.show();
            });
    </script>
    <%-include('footer.ejs')%>