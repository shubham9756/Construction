<%- include('navbar.ejs') %>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f0f2f5;
  margin: 0;
  padding: 20px;
}

.bill-card {
  width: 100%;
  background: #fff;
  padding: 30px 40px;
  border-radius: 10px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  margin: auto;
}

.header {
  text-align: center;
  font-size: 28px;
  font-weight: bold;
  margin-bottom: 30px;
  color: #264db5;
  text-transform: uppercase;
}

.table th, .table td {
  text-align: center;
  font-size: 16px;
  vertical-align: middle;
}

.text-end {
  font-weight: bold;
  font-size: 18px;
  margin-top: 20px;
}

.signature-box {
  margin-top: 40px;
  display: flex;
  justify-content: space-between;
  flex-wrap: wrap;
}

.signature-box div {
  margin-top: 10px;
}

.signature-box img {
  max-width: 250px;
  border: 1px solid #ccc;
  padding: 5px;
  border-radius: 5px;
}

/* === PRINT FIX === */
@media print {
  body {
    background: #fff !important;
    padding: 0 !important;
    margin: 0 !important;
  }

  /* Hide everything except bill */
  nav, footer, .navbar, .sidebar, .footer, .btn, .menu, .collapse, .dropdown, aside {
    display: none !important;
  }

  /* Remove responsive scroll for print */
  .table-responsive {
    overflow: visible !important;
  }

  /* Bill card style */
  .bill-card {
    width: 100% !important;
    padding: 0 !important;
    margin: 0 auto !important;
    background: #fff !important;
    box-shadow: 0 0 10px rgba(0,0,0,0.1) !important;
    page-break-after: auto;
  }

  /* Table full width & break pages nicely */
  .bill-card .table {
    width: 100% !important;
    table-layout: auto !important;
    word-wrap: normal !important;
  }

  .bill-card .table tr {
    page-break-inside: avoid !important;
    page-break-after: auto !important;
  }

  .bill-card .table th, 
  .bill-card .table td {
    font-size: 12pt !important;
  }

  /* Hide print button */
  .bill-card .btn {
    display: none !important;
  }
}
</style>

<div class="bill-card mt-5">
  <div class="header">Purchase Bill</div>

  <div class="row mb-4">
    <div class="col-md-4"><strong>Vendor:</strong> <%= inquiry.vendor_name %></div>
    <div class="col-md-4"><strong>Purchase Date:</strong> <%= inquiry.purchase_date ? inquiry.purchase_date.toString().slice(0,10) : '' %></div>
    <div class="col-md-4"><strong>Purchase Type:</strong> <%= inquiry.purchase_type %></div>
  </div>

  <div class="table-responsive">
    <table class="table table-bordered">
      <thead class="table-light">
        <tr>
          <th>SrNo</th>
          <th>Raw Material</th>
          <th>QTY</th>
          <th>UDM</th>
          <th>Rate</th>
          <th>Discount</th>
          <th>Taxable Value</th>
          <th>GST %</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody>
        <% let grandTotal = 0; %>
        <% inquiry.items.forEach(function(item, index){ 
             grandTotal += parseFloat(item.total) || 0; %>
        <tr>
          <td><%= index + 1 %></td>
          <td><%= item.raw_material %></td>
          <td><%= item.Material_qyt %></td>
          <td><%= item.udm %></td>
          <td><%= parseFloat(item.rate).toFixed(2) %></td>
          <td><%= parseFloat(item.discount).toFixed(2) %></td>
          <td><%= parseFloat(item.Taxable_value).toFixed(2) %></td>
          <td><%= parseFloat(item.gst).toFixed(2) %></td>
          <td><%= parseFloat(item.total).toFixed(2) %></td>
        </tr>
        <% }) %>
      </tbody>
    </table>
  </div>

  <div class="text-end">
    Grand Total: â‚¹ <%= grandTotal.toFixed(2) %>
  </div>

  <div class="signature-box">
    <div>
      <p>Employee Signature:</p>
      <% if (inquiry.employee_sign) { %>
        <img src="<%= inquiry.employee_sign %>" alt="Signature">
      <% } else { %>
        <p>Not Signed</p>
      <% } %>
    </div>
    <div>
      <p>Employee Name: <strong><%= inquiry.employee_signature %></strong></p>
    </div>
  </div>

  <div class="text-center mt-4">
    <button class="btn btn-primary" onclick="window.print()">Print Bill</button>
  </div>
</div>

<%- include('footer.ejs') %>
